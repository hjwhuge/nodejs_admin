<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="../assets/layui/css/layui.css" media="all">
    <script src="../assets/layui/layui.js" charset="utf-8"></script>
    <script src="../assets/jquery-3.2.1.js"></script>
    <style>
    </style>
</head>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">后台管理系统</div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left" style="margin-top: 20px;">
                <span class="layui-breadcrumb">
				  	<a href="../index.html">首页</a>
                    <a href="javascript:;">用户管理</a>
				  	<a href="javascript:;">用户列表</a>
				</span>
            </ul>

            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;">
			          <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
			          贤心
			        </a>
                    <dl class="layui-nav-child">
                        <dd><a href="">基本资料</a></dd>
                        <dd><a href="">安全设置</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item"><a href="">退了</a></li>
            </ul>
        </div>
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item layui-nav-itemed">
                        <a class="" href="javascript:;">商品管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="goodList.html">商品列表</a></dd>
                            <dd><a href="goodsCategory.html">商品分类</a></dd>
                            <dd><a href="AddGoods.html">添加商品</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">用户管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="userCategory.html">用户列表</a></dd>
                            <dd><a href="addUser.html">添加用户</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">订单管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="order.html">订单列表</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>



        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 15px;">
                <div class="listall">
                        <button class="layui-btn">
                            <i class="layui-icon">&#xe608;</i> 添加
                        </button>
                        <button class="layui-btn layui-btn-primary">
                            <i class="layui-icon"></i> 删除
                        </button>
                </div>

                <table class="layui-hide" id="test" lay-filter="test"></table>

                <script type="text/html" id="barDemo">
                    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
				  	<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
				</script>
                <script>
                    layui.use('table', function() {
                        var table = layui.table;

                        table.render({
                            elem: '#test',
                            url: 'user',
                            // toolbar: '#toolbarDemo',
                            title: '用户数据表',
                            page: true,
                            id: 'testReload',
                            // request: {
                            //     pageName: 'curr', //页码的参数名称，默认：page
                            //     limitName: 'nums' //每页数据量的参数名，默认：limit
                            // },
                            cols: [
                                [
                                    { type: 'checkbox', fixed: 'left' }, 
                                    { field: 'id', title: 'ID', width: 80, fixed: 'left', unresize: true, sort: true },
                                    { field: 'username', title: '用户名', width: 80, edit: 'text' }, 
                                    { field: 'sex', title: '性别', width: 80, edit: 'text', sort: true },
                                    { field: 'city', title: '城市', width: 100 }, 
                                    { field: 'sign', title: '签名' }, 
                                    {
                                        field: 'classify',
                                        title: '职业',
                                        width: 150,
                                        edit: 'text',
                                        templet: function(res) {
                                            return '<em>' + res.classify + '</em>'
                                        }
                                    },
                                     
                                    
                                    { field: 'experience', title: '积分', width: 80, sort: true }, 
                                    { field: 'joinTime', title: '加入时间', width: 120 }, 
                                    { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 150 }
                                ]
                            ]
                        });

                        //头工具栏事件
                        // table.on('toolbar(test)', function(obj) {
                        //     var checkStatus = table.checkStatus(obj.config.id);
                        //     switch (obj.event) {
                        //         case 'getCheckData':
                        //             var data = checkStatus.data;
                        //             layer.alert(JSON.stringify(data));
                        //             break;
                        //         case 'getCheckLength':
                        //             var data = checkStatus.data;
                        //             layer.msg('选中了：' + data.length + ' 个');
                        //             break;
                        //         case 'isAll':
                        //             layer.msg(checkStatus.isAll ? '全选' : '未全选');
                        //             break;
                        //     };
                        // });

                        //监听行工具事件
                        table.on('tool(test)', function(obj) {
                            var data = obj.data;
                            // console.log($(this).parent().parent().parent().children().eq(1).children().html());
                            var idnum = $(this).parent().parent().parent().children().eq(1).children().html();
                            console.log(idnum)
                            if (obj.event === 'del') {
                                layer.confirm('真的删除当行么', function(index) {
                                    obj.del();                                                                      
                                    layer.close(index);
                                    let usernameid = $(this).parent();
                                    $.ajax({
                                        type:'get',
                                        url:'/html/user/'+idnum,
                                        success:(data)=>{
                                            console.log(data);
                                        }
                                        
                                    });
                                    
                                });
                            } else if (obj.event === 'edit') {
                                layer.prompt({
                                    formType: 2,
                                    value: data.classify
                                }, function(value, index) {
                                    obj.update({
                                        classify: value
                                    });
                                    layer.close(index);
                                });
                            }
                        });

                        var $ = layui.$, active = {
                            reload: function(){
                                var demoReload = $('#demoReload');
                            
                                //执行重载
                                table.reload('testReload', {
                                    page: {
                                        curr: 1 //重新从第 1 页开始
                                    }
                                    ,where: {
                                        key: {
                                            id: demoReload.val()
                                        }
                                    }
                                });
                            }
                        };
                        
                        $('.demoTable .layui-btn').on('click', function(){
                            var type = $(this).data('type');
                            active[type] ? active[type].call(this) : '';
                        });


                    });
                </script>


            </div>
        </div>


        <div class="layui-footer">
            <!-- 底部固定区域 -->
            底部固定区域
        </div>
        

        <script>
            //JavaScript代码区域
            layui.use('element', function() {
                var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
                //监听导航点击
                element.on('nav(demo)', function(elem){
                    // console.log(elem);
                    layer.msg(elem.text());
                });
            });
        </script>
        
</body>

</html>